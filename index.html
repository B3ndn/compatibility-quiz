<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compatibility Quiz</title>
    <!-- Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include Charter font -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/charter/index.min.css">
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Charter', serif;
            background-image: url('https://rootsofprogress.org/u/2024/06/RPI_Imagery_everyoneandnow_1939_New_York_Worlds_Fair_in_a_sunny_light_envir_fbdee22f-b308-405f-a714-b94e2c4b1404.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border-radius: 1rem;
        }
        .slider {
            width: 100%;
            height: 8px;
            margin: 20px 0;
        }
        .hidden {
            display: none;
        }
        .option-button {
            transition: all 0.2s;
        }
        .option-button:hover {
            transform: translateY(-2px);
        }
        .tooltip {
            position: relative;
            cursor: pointer;
            color: blue;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #f9f9f9;
            color: #333;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the text */
            left: 50%;
            margin-left: -125px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        /* Ensure links inside tooltips are also blue */
        .tooltip .tooltiptext a {
            color: blue;
            text-decoration: underline;
        }
    </style>
    <!-- JavaScript with defer attribute -->
    <script defer>
    // Quiz Data
    const sections = [
        {
            name: "Lifestyle Alignment",
            weight: 2,
            questions: [
                {
                    text: "How often do you drink alcohol?",
                    type: "choice",
                    isDealbreaker: true,
                    options: [
                        { text: "I don't drink at all.", isAcceptable: true },
                        { text: "Rarely.", isAcceptable: true },
                        { text: "Regularly.", isAcceptable: false }
                    ]
                },
                {
                    text: "What is your stance on adopting a vegan or plant-based diet?",
                    type: "choice",
                    options: [
                        { text: "I'm already vegan.", score: 10 },
                        { text: "I'm willing to become vegan.", score: 8 },
                        { text: "I might consider it.", score: 5 },
                        { text: "I'm not interested.", score: 0 }
                    ]
                },
                {
                    text: "How do you feel about traveling, moving to new places, or experiencing new things?",
                    type: "choice",
                    options: [
                        { text: "I love it and seek out new experiences regularly.", score: 10 },
                        { text: "I'm open to it and enjoy new experiences occasionally.", score: 7 },
                        { text: "I'm comfortable with familiar settings.", score: 3 },
                        { text: "I prefer to stay where I am.", score: 0 }
                    ]
                },
                {
                    text: "What is your relationship experience?",
                    type: "choice",
                    options: [
                        { text: "I've never been in a relationship.", score: 10 },
                        { text: "I've had one or two relationships.", score: 7 },
                        { text: "I've been in several relationships.", score: 2 },
                    ]
                },
                // Dealbreaker questions
                {
                    text: "Do you want to have children in the future?",
                    type: "choice",
                    isDealbreaker: true,
                    options: [
                        { text: "Yes, definitely.", isAcceptable: true },
                        { text: "Maybe, I'm open to it.", isAcceptable: true },
                        { text: "No, I don't want children.", isAcceptable: false }
                    ]
                },
                {
                    text: "Do you use any recreational drugs?",
                    type: "choice",
                    isDealbreaker: true,
                    options: [
                        { text: "No, I don't use drugs.", isAcceptable: true },
                        { text: "Occasionally.", isAcceptable: false },
                        { text: "Yes, regularly.", isAcceptable: false }
                    ]
                },
                {
                    text: "Do you prefer monogamous relationships?",
                    type: "choice",
                    isDealbreaker: true,
                    options: [
                        { text: "Yes, I prefer monogamy.", isAcceptable: true },
                        { text: "No, I prefer open or polyamorous relationships.", isAcceptable: false }
                    ]
                },
                {
                    text: "Are you under 25 years old?",
                    type: "choice",
                    isDealbreaker: true,
                    options: [
                        { text: "Yes.", isAcceptable: true },
                        { text: "No.", isAcceptable: false }
                    ]
                },
                {
                    text: "How seriously do you take your health?",
                    type: "choice",
                    isDealbreaker: true,
                    options: [
                        { text: "Very seriously; I prioritize health.", isAcceptable: true },
                        { text: "Somewhat seriously.", isAcceptable: true },
                        { text: "Not very seriously.", isAcceptable: false }
                    ]
                },
                {
                    text: "Do you enjoy participating in sports?",
                    type: "choice",
                    isDealbreaker: false,
                    options: [
                        { text: "Yes, I love it.", isAcceptable: true, score: 0 },
                        { text: "Sometimes.", isAcceptable: true, score: 4 },
                        { text: "Not at all.", isAcceptable: true, score: 8 }
                    ]
                }
            ]
        },
        {
            name: "Worldview Alignment",
            description: "Don't overthink these questions. They're mostly meant to serve as jumping off points for discussions and debates!",
            weight: 1,
            questions: [
                {
                    text: "\"Any sufficiently advanced technology is indistinguishable from magic.\" - Arthur C. Clarke.",
                    type: "slider"
                },
                {
                    text: "We should attempt to quantify the sacred.",
                    type: "choice",
                    weight: 3, // Increased weight
                    options: [
                        { text: "Yes", score: 10 },
                        { text: "No", score: 0 }
                    ]
                },
                {
                    text: "Imagine you discover a machine that can \"tweak\" people’s moral compass to make them more compassionate, but it’s irreversible. Would you use it, knowing it applies to everyone?",
                    type: "choice",
                    options: [
                        { text: "Yes, compassion should be universal.", score: 0 },
                        { text: "No, people should make that choice themselves.", score: 8 },
                    ]
                },
                {
                    text: "You discover a mysterious button in a dusty library. If you press it, everyone in the world gets a random, but harmless, change to their personality. Do you press it?",
                    type: "choice",
                    options: [
                        { text: "Yes! Chaos can be enlightening.", score: 5 },
                        { text: "No, I’d rather people stay as they are.", score: 2 },
                        { text: "Maybe… I’d need to study the button for a while.", score: 8 },
                    ]
                },
                {
                    text: "A glowing door opens in the air in front of you. It's visibly crackling around the edges and shrinking slowly but visibly, so you don't have much time to decide. You have been told nothing about this. Do you go through the portal?",
                    type: "choice",
                    weight: 3, // Increased weight
                    options: [
                        { text: "Yes", score: 10 },
                        { text: "No", score: 0 }
                    ]
                },
                {
                    text: "If you had freedom over basic biological proclivities (e.g., hunger), would you shut them off?",
                    type: "choice",
                    weight: 3, // Increased weight
                    options: [
                        { text: "Yes", score: 10 },
                        { text: "No", score: 0 },
                        { text: "Depends on the situation (e.g., maybe I'd still want hunger before having a social meal, but not at other times)", score: 5 }
                    ]
                },
                {
                    text: "Imagine you find a technology that lets you \"clone\" your consciousness to keep working on your goals after you’re gone. Do you use it?",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 10 },
                        { text: "No", score: 0 },
                        { text: "Only if I’m confident the \"clone\" wouldn’t stray from my values.", score: 7 }
                    ]
                },
                {
                    text: "It's important to consider how our actions affect humanity's long-term future",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 5 },
                        { text: "No", score: 0 },
                    ]
                },
                {
                    text: "If you could press a button to remove all illusions about yourself, revealing every unconscious bias, fear, or motive, would you press it?",
                    type: "choice",
                    options: [
                        { text: "Yes, self-knowledge is worth facing any discomfort it brings.", score: 10 },
                        { text: "No, some illusions might be crucial for a functional, content self.", score: 0 },
                        { text: "I’d press it, but I’d want a slow reveal to process everything gradually.", score: 7 },
                        { text: "I’d hesitate; complete self-transparency sounds destabilizing.", score: 3 }
                    ]
                },
                {
                    text: "You’re given the opportunity to understand all that is true about love—its evolutionary roots, its limits, and the full mechanics of attraction. Do you want to know, even if it might change your experience of it?",
                    type: "choice",
                    weight: 3, // Increased weight
                    options: [
                        { text: "Yes, understanding love would be worth any change in perception.", score: 10 },
                        { text: "No, mystery is part of what makes love special.", score: 0 },
                        { text: "I’d want to know some aspects, but leave the experience itself untouched.", score: 5 },
                        { text: "I’d take the knowledge but use it sparingly.", score: 7 }
                    ]
                },
                {
                    text: "Imagine you’re given a chance to erase one aspect of your personality, something you find challenging or harmful. Do you go through with it, or keep it as part of your identity?",
                    type: "choice",
                    options: [
                        { text: "Yes, if it improves my well-being or relationships.", score: 10 },
                        { text: "No, my flaws are integral to my growth and self-acceptance.", score: 0 },
                        { text: "Only if I’m sure it won’t have unintended consequences.", score: 5 },
                    ]
                },
                {
                    text: "Suppose you’re given the option to shape your ideal future but with one condition: you’ll never receive recognition for any of your achievements or efforts. Do you accept this path?",
                    type: "choice",
                    weight: 3, // Increased weight
                    options: [
                        { text: "Yes, personal satisfaction is enough; recognition isn’t essential.", score: 10 },
                        { text: "No, recognition is part of what gives meaning to success.", score: 0 },
                    ]
                },
                // New Meme Question
                {
                    text: '<img src="https://lh4.googleusercontent.com/WV2qVEVrkCnyXL9-TlacGddpMRdaydahpPVpXo5XNtz1Z43LudkP-viQDS-FLust9-AaDezLAJbFDg6o_YduC5dUutHQAcwcxGGYDREQpKLCz7dyuYQ4HMMDMjuCrfWNFQ=w1280" alt="Meme" class="mx-auto mb-4" style="max-width: 100%;"><br>Thoughts?',
                    type: "choice",
                    options: [
                        { text: "Good meme", score: 5 },
                        { text: "Hate it", score: 0 },
                        { text: "Eh", score: 2 }
                    ]
                }
            ]
        },
        {
            name: "Personality Alignment",
            weight: 2,
            questions: [
                {
                    text: "I'm generally emotionally stable and don't get frustrated easily",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 10 },
                        { text: "For the most part", score: 2 },
                        { text: "No", score: 0 }
                    ]
                },
                {
                    text: "I believe in love at first sight",
                    type: "choice",
                    options: [
                        { text: "Definitely not", score: 10 },
                        { text: "No, but I believe in lust at first sight", score: 10 },
                        { text: "Yes", score: 0 }
                    ]
                },
                {
                    text: "When facing a challenge...",
                    type: "choice",
                    options: [
                        { text: "Break it down and tackle systematically", score: 10 },
                        { text: "Stay persistent until solved", score: 7 },
                        { text: "Try and see what happens", score: 0 }
                    ]
                },
                {
                    text: "If a friend is having a hard time...",
                    type: "choice",
                    options: [
                        { text: "Listen carefully and help plan solutions", score: 10 },
                        { text: "Offer support and comfort", score: 3 },
                        { text: "Give them space", score: 3 }
                    ]
                },
                {
                    text: "I've decided what I intrinsically value in life",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 10 },
                        { text: "Still working it out", score: 5 },
                        { text: "No", score: 0 }
                    ]
                },
                {
                    text: "My friends would describe me as kind and altruistic.",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 10 },
                        { text: "For the most part", score: 7 },
                        { text: "Not really", score: 2 }
                    ]
                },
                {
                    text: "I like going on long walks",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 8 },
                        { text: "Not really", score: 0 },
                    ]
                },
                {
                    text: "Did you have any weird hobbies as a child?",
                    type: "choice",
                    options: [
                        { text: "Yes, quite a few", score: 10 },
                        { text: "One or two unusual interests", score: 7 },
                        { text: "Pretty standard hobbies", score: 3 }
                    ]
                },
                {
                    text: "Do you remember your dreams?",
                    type: "choice",
                    options: [
                        { text: "Yes, regularly and vividly", score: 10 },
                        { text: "Sometimes/partially", score: 6 },
                        { text: "Rarely or never", score: 2 }
                    ]
                },
                {
                    text: "If someone in prison completely loses their memories...",
                    type: "choice",
                    options: [
                        { text: "They should be released - they're effectively a different person", score: 10 },
                        { text: "It depends on risk assessment", score: 5 },
                        { text: "They should complete their sentence", score: 0 }
                    ]
                },
                {
                    text: "Would you redesign human nature if given the chance?",
                    type: "choice",
                    options: [
                        { text: "Yes, there's clear room for optimization", score: 10 },
                        { text: "Maybe, with careful consideration", score: 6 },
                        { text: "No, too risky/wrong", score: 0 }
                    ]
                },
                {
                    text: "When you're upset during a conversation, how do you typically respond?",
                    type: "choice",
                    weight: 3, // Increased weight
                    options: [
                        { text: "I remain calm and continue the dialogue to resolve the issue.", score: 10 },
                        { text: "I need a short break to collect my thoughts but return to discuss.", score: 7 },
                        { text: "I tend to shut down or leave the conversation abruptly.", score: 0 }
                    ]
                },
                {
                    text: "How do you handle unresolved conflicts in a relationship?",
                    type: "choice",
                    options: [
                        { text: "I believe in addressing them directly until we reach a resolution.", score: 10 },
                        { text: "I discuss them but can accept agreeing to disagree.", score: 5 },
                        { text: "I prefer to avoid confrontation and let issues fade over time.", score: 0 }
                    ]
                },
                {
                    text: "I've been told that I am weird or alien in some ways, with specific examples",
                    type: "choice",
                    options: [
                        { text: "Yep", score: 10 },
                        { text: "Yes, but without specific examples", score: 5 },
                        { text: "No", score: 0 },
                    ]
                },
                {
                    text: "Do you believe that most personal differences can be worked through with effort?",
                    type: "choice",
                    options: [
                        { text: "Yes, with commitment, we can find solutions to any issue.", score: 10 },
                        { text: "Some issues can be resolved, others may not.", score: 5 },
                        { text: "No, some differences are irreconcilable.", score: 2 }
                    ]
                },
                {
                    text: "I highly value emotional control in my partner",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 10 },
                        { text: "It's up there, but I value other things equally if not more", score: 0 },
                        { text: "Not really", score: 0 }
                    ]
                },
                {
                    text: "I like shopping for clothes",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 0 },
                        { text: "Only when necessary", score: 10 },
                        { text: "No", score: 10 }
                    ]
                },
                {
                    text: "Overall, the world has been...",
                    type: "choice",
                    options: [
                        { text: "Getting better over time", score: 10 },
                        { text: "Getting worse over time", score: 0 },
                    ]
                },
                {
                    text: "In the long-term, humanity should...",
                    type: "choice",
                    options: [
                        { text: "Stay on Earth", score: 0 },
                        { text: "Take to the stars", score: 3 },
                    ]
                },
                {
                    text: "If someone is in a relationship, they should create a system for optimizing both day-to-day and long-term responsibilities",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 10 },
                        { text: "A mixture of that and going with the flow", score: 0 },
                        { text: "No", score: 0 }
                    ]
                },
                {
                    text: 'The concept of a "relationship contract" is appealing to me',
                    type: "choice",
                    options: [
                        { text: "Yes, we should both have clarity on what we want from our relationship, what would lead to us breaking up, etc", score: 10 },
                        { text: "No, this seems unromantic", score: 0 },
                    ]
                },
                {
                    text: "If I were to read a book about relationships and see chapter titles such as The Economics of Relationships or Cognitive Integration in Marriage and Long-Term Relationships, this would be...",
                    type: "choice",
                    options: [
                        { text: "Offputting and weird", score: 0 },
                        { text: "Interesting, but not for me", score: 0 },
                        { text: "Enticing and important", score: 8 },
                    ]
                },
                {
                    text: "I can be very silly sometimes",
                    type: "choice",
                    options: [
                        { text: "Yes", score: 3 },
                        { text: "I'm pretty serious", score: 0 },
                    ]
                },
                {
                    text: "Will humans in 1,000 years still be falling in love, as we understand it today?",
                    type: "choice",
                    options: [
                        { text: "Yes, and this would be a good thing", score: 0 },
                        { text: "Yes, and this would be a bad thing", score: 3 },
                        { text: "No, and this would be a good thing", score: 3 },
                        { text: "No, and this would be a bad thing", score: 0 },
                    ]
                },
                {
                    text: "Are you more of an..",
                    type: "choice",
                    options: [
                        { text: "Introvert", score: 10 },
                        { text: "Introvert, but good at pretending to be social", score: 10 },
                        { text: "Extrovert", score: 0 },
                    ]
                },
                {
                    text: "I would rather be...",
                    type: "choice",
                    options: [
                        { text: "Very kind", score: 10 },
                        { text: "Very intelligent", score: 0 },
                    ]
                },
                {
                    text: "In a relationship, do you prefer to be accepted as you are or challenged to grow?",
                    type: "choice",
                    weight: 3, // Increased weight
                    options: [
                        { text: "I prefer to be challenged to reach my full potential.", score: 10 },
                        { text: "A balance of acceptance and gentle encouragement.", score: 6 },
                        { text: "I want to be accepted fully as I am without change.", score: 0 }
                    ]
                },
                {
                    text: "My partner and I should push each other, even if it's sometimes uncomfortable, to become our ideal selves rather than simply accepting each other as we are.",
                    type: "slider"
                },
                {
                    text: "I believe in practicing radical honesty in relationships, sharing thoughts and feelings openly even if they might be uncomfortable.",
                    type: "slider"
                },
                {
                    text: "Which of the following broadly describes your political views?",
                    type: "choice",
                    options: [
                        { text: "Economically right-wing, socially left-wing.", score: 10 },
                        { text: "Economically right-wing, socially right-wing.", score: 7 },
                        { text: "Centrist or mix of positions.", score: 5 },
                        { text: "Economically left-wing, socially right-wing.", score: 2 },
                        { text: "Economically left-wing, socially left-wing.", score: 2 }
                    ]
                }
            ]
        }
    ];

    // State Variables
    let currentSectionIndex = 0;
    let currentQuestionIndex = 0;
    let sectionScores = [];
    let sectionMaxScores = [];
    let dealbreakerFailed = false; // Flag to check if a dealbreaker question was answered "incorrectly"

    // Function to Show Instructions
    function showInstructions() {
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('instructions-screen').classList.remove('hidden');
    }

    // Function to Start Quiz
    function startQuiz() {
        document.getElementById('instructions-screen').classList.add('hidden');
        document.getElementById('question-screen').classList.remove('hidden');

        // Initialize Scores
        sectionScores = sections.map(() => 0);
        sectionMaxScores = sections.map((section) => {
            const maxScore = section.questions
                .filter(q => !q.isDealbreaker)
                .reduce((sum, q) => {
                    const questionWeight = q.weight || 1;
                    // Assuming maximum score per option is 10
                    const questionMaxScore = 10 * section.weight * questionWeight;
                    return sum + questionMaxScore;
                }, 0);
            return maxScore;
        });

        currentSectionIndex = 0;
        currentQuestionIndex = 0;
        dealbreakerFailed = false;
        showQuestion();
    }

    // Function to Show Current Question
    function showQuestion() {
        const section = sections[currentSectionIndex];
        const question = section.questions[currentQuestionIndex];
        document.getElementById('section-name').textContent = section.name;

        // Set Section Description if it exists
        const sectionDescription = document.getElementById('section-description');
        if (section.description) {
            sectionDescription.textContent = section.description;
            sectionDescription.classList.remove('hidden');
        } else {
            sectionDescription.textContent = '';
            sectionDescription.classList.add('hidden');
        }

        document.getElementById('question-text').innerHTML = question.text;

        // Update Progress Bar
        const totalQuestions = section.questions.length;
        const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;

        const multipleChoice = document.getElementById('multiple-choice');
        const sliderContainer = document.getElementById('slider-container');

        if (question.type === 'choice') {
            multipleChoice.classList.remove('hidden');
            sliderContainer.classList.add('hidden');
            multipleChoice.innerHTML = question.options.map((option, index) => `
                <button 
                    onclick="selectOption(${index})" 
                    class="option-button w-full text-left p-4 rounded-lg border border-gray-200 hover:border-blue-500 hover:bg-blue-50"
                >
                    ${option.text}
                </button>
            `).join('');
        } else if (question.type === 'slider') {
            multipleChoice.classList.add('hidden');
            sliderContainer.classList.remove('hidden');
            const slider = document.getElementById('slider');
            slider.min = question.min || 0;
            slider.max = question.max || 100;
            slider.value = Math.floor((slider.min + slider.max) / 2);
            document.getElementById('slider-value').textContent = `${slider.value}%`;
            document.getElementById('slider-left-label').textContent = question.sliderLeftLabel || "Strongly Disagree";
            document.getElementById('slider-right-label').textContent = question.sliderRightLabel || "Strongly Agree";

            // Remove previous event listeners to prevent multiple bindings
            const newSlider = slider.cloneNode(true);
            slider.parentNode.replaceChild(newSlider, slider);

            newSlider.addEventListener('input', function() {
                document.getElementById('slider-value').textContent = `${this.value}%`;
            });

            // Attach event listener to the Next button
            const sliderNextButton = document.querySelector('#slider-container button');
            sliderNextButton.onclick = submitSlider;
        }
    }

    // Function to Handle Choice Selection
    function selectOption(index) {
        const section = sections[currentSectionIndex];
        const question = section.questions[currentQuestionIndex];
        const selectedOption = question.options[index];

        if (question.isDealbreaker && !selectedOption.isAcceptable) {
            dealbreakerFailed = true;
        }

        if (!question.isDealbreaker) {
            const questionWeight = question.weight || 1; // Default weight is 1
            const optionScore = (selectedOption.score || 0) * section.weight * questionWeight;
            sectionScores[currentSectionIndex] += optionScore;
        }
        nextQuestion();
    }

    // Function to Handle Slider Submission
    function submitSlider() {
        const value = parseInt(document.getElementById('slider').value) || 0;
        const section = sections[currentSectionIndex];
        const question = section.questions[currentQuestionIndex];

        if (question.isDealbreaker) {
            // Handle dealbreaker logic for slider if needed
            // Currently, no dealbreaker sliders defined
        } else {
            const questionWeight = question.weight || 1; // Default weight is 1
            const sliderScore = ((value / 100) * 10) * section.weight * questionWeight;
            sectionScores[currentSectionIndex] += sliderScore;
        }
        nextQuestion();
    }

    // Function to Proceed to Next Question or Section
    function nextQuestion() {
        const section = sections[currentSectionIndex];
        if (currentQuestionIndex < section.questions.length - 1) {
            currentQuestionIndex++;
        } else {
            // Check if we need to end the quiz early due to dealbreaker in the first section
            if (currentSectionIndex === 0 && dealbreakerFailed) {
                showResults();
                return;
            }

            if (currentSectionIndex < sections.length - 1) {
                currentSectionIndex++;
                currentQuestionIndex = 0;
            } else {
                showResults();
                return;
            }
        }
        showQuestion();
    }

    // Function to Display Results
    function showResults() {
        // Filter out any undefined or NaN values
        const validSectionScores = sectionScores.filter(score => typeof score === 'number' && !isNaN(score));
        const validSectionMaxScores = sectionMaxScores.filter(score => typeof score === 'number' && !isNaN(score));

        let totalScore = validSectionScores.reduce((a, b) => a + b, 0);
        const maxPossibleScore = validSectionMaxScores.reduce((a, b) => a + b, 0);

        // Prevent totalScore from being less than zero
        totalScore = Math.max(0, totalScore);

        let percentage = (totalScore / maxPossibleScore) * 100;

        if (dealbreakerFailed) {
            totalScore = 0;
            percentage = 0;
        }

        // Cap percentage at 100%
        percentage = Math.min(percentage, 100);

        let message;
        if (dealbreakerFailed) {
            message = "Unfortunately, we have some fundamental differences that are important to me.";
        } else if (percentage >= 70) {
            message = "High compatibility detected! We should talk to each other!";
        } else if (percentage >= 50) {
            message = "We have quite a bit of alignment. There's definitely potential!";
        } else if (percentage >= 35) {
            message = "We may not be compatible, but should get to know each other more to be sure!";
        } else {
            message = "We don't seem very compatible :(";
        }

        const resultsScreen = document.getElementById('results-screen');
        document.getElementById('question-screen').classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        // Conditionally include additional sections
        let additionalContent = '';
        if (percentage >= 35) {
            additionalContent = `
                <!-- New Section: Let's Get in Touch -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">Let's get in touch!</h3>
                    <p class="text-gray-700 mb-2"><strong>Phone:</strong> <a href="tel:+447305204222" class="text-blue-600 underline">+44 7305 204222</a></p>
                    <p class="text-gray-700"><strong>Email:</strong> <a href="mailto:ben_dnorman@icloud.com" class="text-blue-600 underline">ben_dnorman@icloud.com</a></p>
                </div>
                
            `;
        }

        resultsScreen.innerHTML = `
            <div class="text-center">
                <h2 class="text-2xl font-bold mb-6">Overall Compatibility Score</h2>
                <div class="text-5xl font-bold text-blue-500 mb-6">${percentage.toFixed(1)}%</div>
                <div class="w-full bg-gray-200 rounded-full h-4 mb-6">
                    <div class="bg-blue-500 rounded-full h-4 transition-all duration-1000" style="width: ${percentage}%"></div>
                </div>
                <p class="text-lg mb-8">${message}</p>
                ${additionalContent}
                <button onclick="location.reload()" class="mt-8 bg-gray-500 text-white py-2 px-6 rounded-lg hover:bg-gray-600">
                    Retake Quiz
                </button>
            </div>
        `;
    }

    // Initialize Event Listeners After DOM is Loaded
    document.addEventListener('DOMContentLoaded', () => {
        const beginQuizButton = document.getElementById('begin-quiz-button');
        if (beginQuizButton) {
            beginQuizButton.addEventListener('click', showInstructions);
        }

        const startQuizButton = document.querySelector('#instructions-screen button');
        if (startQuizButton) {
            startQuizButton.addEventListener('click', startQuiz);
        }

        // Slider submission buttons are dynamically handled in showQuestion()
    });
    </script>
</head>
<body class="min-h-screen py-12">
    <div class="max-w-2xl mx-auto px-4">
        <div class="glass p-8">
            <!-- Start Screen -->
            <div id="start-screen">
                <h1 class="text-4xl font-bold text-center mb-6">How Compatible Are We?</h1>
                <p class="text-gray-600 text-center mb-8 text-lg">
                    Let's explore our alignment across different dimensions :)
                </p>
                <button id="begin-quiz-button" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 mb-6">
                    Begin Quiz
                </button>

                <!-- Personal Information Section -->
                <div class="mt-6 p-6 border border-gray-300 rounded-lg bg-white bg-opacity-75">
                    <h2 class="text-2xl font-semibold mb-4 text-center">Basic Info About Me</h2>
                    <p class="text-gray-700 mb-4 text-center">
                        Read this to help you decide if you want to spend 5-10 mins on the quiz!
                    </p>
                    <!-- New Section moved to the top -->
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold mb-2 text-center">What I want to do with my existence:</h3>
                        <p class="text-blue-600 text-center">
                            <a href="https://existential-risk.com/" target="_blank">Protect</a> and 
                            <a href="https://www.lesswrong.com/tag/world-optimization" target="_blank">promote</a> 
                            the 
                            <a href="https://80000hours.org/articles/future-generations/" target="_blank">long-term future of humanity</a> 
                            <span class="tooltip">and beyond
                                <span class="tooltiptext">By "beyond" I refer both to other forms of sentience (e.g., non-human animals, future AI systems), and post-humans.</span>
                            </span>.
                            <span class="tooltip">*
                                <span class="tooltiptext">
                                    This is a very high-level description of what I intend to do with my existence. I have far more specific plans, ideas, and projects. Since you were intrigued enough to click on this asterisk, I'd love to discuss them with you!
                                </span>
                            </span>
                        </p>
                    </div>
                    <ul class="text-gray-700 space-y-2">
                        <li><strong>Age:</strong> 20 years old</li>
                        <li><strong>Gender:</strong> Male</li>
                        <li><strong>Sexual Orientation:</strong> Straight</li>
                        <li><strong>Relationship Preference:</strong> Monogamous</li>
                        <li><strong>Family Plans:</strong> I want to have kids</li>
                        <li><strong>Current Location:</strong> London, UK</li>
                        <li><strong>Citizenship:</strong> Canadian</li>
                        <li><strong>Looking For:</strong> A serious relationship / life partner</li>
                        <li><strong>Education:</strong> Pursuing a Bachelor's (BASc) degree</li>
                        <li><strong>Diet:</strong> Vegan since birth</li>
                        <li><strong>Politics:</strong> 
                            <a href="https://cnliberalism.org/overview" target="_blank" class="text-blue-600 underline">Roughly this</a>, with some sympathies for 
                            <a href="https://www.richardhanania.com/p/understanding-the-tech-right" target="_blank" class="text-blue-600 underline">this</a>
                        </li>
                        <li><strong>Lifestyle:</strong> I don't drink or use drugs</li>
                        <li><strong>Height:</strong> 5'11</li>
                        <li><strong>Religion:</strong> Atheist (with a Jewish background)</li>
                        <li><strong>MBTI:</strong> INTJ
                            <span class="tooltip">*
                                <span class="tooltiptext">
                                    Though I think MBTI is kind of like "astrology for nerds" and shouldn't be taken too seriously
                                </span>
                            </span>
                        </li>
                    </ul>
                </div>

                <!-- New Section: How I Approach Relationships -->
                <div class="mt-6 p-6 border border-gray-300 rounded-lg bg-white bg-opacity-75">
                    <h2 class="text-2xl font-semibold mb-4 text-center">How I Approach Relationships</h2>
                    <p class="text-gray-700 mb-4">
                        Here is a list of the best things I've read on the topic of relationships:
                    </p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>
                            <strong>Book:</strong> <a href="https://www.goodreads.com/book/show/54588456-the-pragmatist-s-guide-to-relationships" target="_blank" class="text-blue-600 underline">The Pragmatist's Guide to Relationships by Simone and Malcolm Collins</a>
                        </li>
                        <li>
                            <strong>Essay:</strong> <a href="https://briantomasik.com/personal-thoughts-on-romance/" target="_blank" class="text-blue-600 underline">Personal thoughts on romance by Brian Tomasik</a>
                        </li>
                        <li>
                            <strong>Blog Post:</strong> <a href="https://www.betonit.ai/p/shes-the-one" target="_blank" class="text-blue-600 underline">She's the One by Bryan Caplan</a>
                        </li>
                        <li>
                            <strong>Blog Post:</strong> <a href="https://waitbutwhy.com/2014/02/pick-life-partner.html" target="_blank" class="text-blue-600 underline">How to Pick Your Life Partner by Tim Urban</a>
                        </li>
                        <li>
                            <strong>Blog Post:</strong> <a href="https://colah.github.io/personal/micromarriages/" target="_blank" class="text-blue-600 underline">Micromarriages by Chris Olah</a>
                        </li>
                    </ul>
                </div>
                <!-- End of New Section -->

            </div>

            <!-- Instructions Screen -->
            <div id="instructions-screen" class="hidden">
                <h2 class="text-2xl font-semibold mb-4 text-center">Before You Begin</h2>
                <p class="text-gray-700 mb-6 text-center">
                    Some of the questions in this quiz are intentionally a bit vague. Feel free to interpret them in a way that makes sense to you. Take as much time or as little time as you'd like to think about each question. Please answer the questions as honestly as you can!
                </p>
                <button class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600">
                    Start Quiz
                </button>
            </div>

            <!-- Question Screen -->
            <div id="question-screen" class="hidden">
                <h2 id="section-name" class="text-2xl font-semibold mb-4"></h2>
                <p id="section-description" class="text-gray-600 mb-4 hidden"></p>
                <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                    <div id="progress-bar" class="bg-blue-500 rounded-full h-2 transition-all duration-300" style="width: 0%"></div>
                </div>

                <h2 id="question-text" class="text-xl font-semibold mb-6"></h2>

                <!-- Multiple Choice Container -->
                <div id="multiple-choice" class="space-y-3"></div>

                <!-- Slider Container -->
                <div id="slider-container" class="hidden">
                    <input type="range" id="slider" class="slider" min="0" max="100" value="50">
                    <div class="flex justify-between text-sm text-gray-600">
                        <span id="slider-left-label">Strongly Disagree</span>
                        <span id="slider-value">50%</span>
                        <span id="slider-right-label">Strongly Agree</span>
                    </div>
                    <button class="mt-4 w-full bg-blue-500 text-white py-2 px-6 rounded-lg hover:bg-blue-600">
                        Next
                    </button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="hidden"></div>
        </div>
    </div>
</body>
</html>


