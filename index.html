<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compatibility Quiz</title>
    <!-- Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include Charter font -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/charter/index.min.css">
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Charter', serif;
            background-image: url('https://rootsofprogress.org/u/2024/06/RPI_Imagery_everyoneandnow_1939_New_York_Worlds_Fair_in_a_sunny_light_envir_fbdee22f-b308-405f-a714-b94e2c4b1404.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border-radius: 1rem;
        }
        .slider {
            width: 100%;
            height: 8px;
            margin: 20px 0;
        }
        .hidden {
            display: none;
        }
        .option-button {
            transition: all 0.2s;
        }
        .option-button:hover {
            transform: translateY(-2px);
        }
        .tooltip {
            position: relative;
            cursor: pointer;
            color: blue;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #f9f9f9;
            color: #333;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the text */
            left: 50%;
            margin-left: -125px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        /* Ensure links inside tooltips are also blue */
        .tooltip .tooltiptext a {
            color: blue;
            text-decoration: underline;
        }
    </style>
</head>
<body class="min-h-screen py-12">
    <div class="max-w-2xl mx-auto px-4">
        <div class="glass p-8">
            <!-- Start Screen -->
            <div id="start-screen">
                <h1 class="text-4xl font-bold text-center mb-6">How Compatible Are We?</h1>
                <p class="text-gray-600 text-center mb-8 text-lg">
                    Let's explore our alignment across different dimensions.
                </p>
                <button onclick="showInstructions()" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 mb-6">
                    Begin Quiz
                </button>

                <!-- Personal Information Section -->
                <div class="mt-6 p-6 border border-gray-300 rounded-lg bg-white bg-opacity-75">
                    <h2 class="text-2xl font-semibold mb-4 text-center">Basic Info About Me</h2>
                    <p class="text-gray-700 mb-4 text-center">
                        Read this to help you decide if you want to spend 5-10 mins on the quiz!
                    </p>
                    <!-- New Section moved to the top -->
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold mb-2 text-center">What I want to do with my existence:</h3>
                        <p class="text-blue-600 text-center">
                            <a href="https://existential-risk.com/" target="_blank">Protect</a> and 
                            <a href="https://www.lesswrong.com/tag/world-optimization" target="_blank">promote</a> 
                            the 
                            <a href="https://80000hours.org/articles/future-generations/" target="_blank">long-term future of humanity</a> 
                            <span class="tooltip">and beyond
                                <span class="tooltiptext">By "beyond" I refer both to other forms of sentience (e.g., non-human animals, future AI systems), and post-humans.</span>
                            </span>.
                            <span class="tooltip">*
                                <span class="tooltiptext">
                                    This is a very high-level description of what I intend to do with my existence. I have far more specific plans, ideas, and projects. Since you were intrigued enough to click on this asterisk, I'd love to discuss them with you!
                                </span>
                            </span>
                        </p>
                    </div>
                    <ul class="text-gray-700 space-y-2">
                        <li><strong>Age:</strong> 20 years old</li>
                        <li><strong>Gender:</strong> Male</li>
                        <li><strong>Sexual Orientation:</strong> Straight</li>
                        <li><strong>Relationship Preference:</strong> Monogamous</li>
                        <li><strong>Family Plans:</strong> I very much want kids</li>
                        <li><strong>Current Location:</strong> London, UK</li>
                        <li><strong>Citizenship:</strong> Canadian</li>
                        <li><strong>Looking For:</strong> A serious relationship / life partner</li>
                        <li><strong>Education:</strong> Pursuing a Bachelor's (BASc) degree</li>
                        <li><strong>Diet:</strong> Vegan since birth</li>
                        <li><strong>Politics:</strong> 
                            <a href="https://cnliberalism.org/overview" target="_blank" class="text-blue-600 underline">Roughly this</a>, with some sympathies for 
                            <a href="https://www.richardhanania.com/p/understanding-the-tech-right" target="_blank" class="text-blue-600 underline">this</a>
                        </li>
                        <li><strong>Lifestyle:</strong> I don't drink or use drugs</li>
                        <li><strong>Appearance:</strong> 5'11, ~170lbs, <a href="https://drive.google.com/file/d/1aiI0G_CfBydS4_xcQaD_Q7qHNoOLp8HW/view?usp=sharing" target="_blank" class="text-blue-600 underline">some photos of me</a></li>
                        <li><strong>Religion:</strong> Atheist (with a Jewish background)<span class="tooltip">*
                            <span class="tooltiptext">
                                Sympathetic to <a href="https://technopuritan.com/" target="_blank" class="text-blue-600 underline">Techno-Puritanism</a>
                            </span>
                        </span></li>
                        <li><strong>MBTI:</strong> INTJ
                            <span class="tooltip">*
                                <span class="tooltiptext">
                                    Though I think MBTI is kind of like "astrology for nerds" and shouldn't be taken too seriously
                                </span>
                            </span>
                        </li>
                    </ul>
                </div>

                <!-- New Section: How I Approach Relationships -->
                <div class="mt-6 p-6 border border-gray-300 rounded-lg bg-white bg-opacity-75">
                    <h2 class="text-2xl font-semibold mb-4 text-center">How I Approach Relationships</h2>
                    <p class="text-gray-700 mb-4">
                        Here is a list of the best things I've read on the topic of relationships:
                    </p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>
                            <strong>Book:</strong> <a href="https://www.goodreads.com/book/show/54588456-the-pragmatist-s-guide-to-relationships" target="_blank" class="text-blue-600 underline">The Pragmatist's Guide to Relationships by Simone and Malcolm Collins</a>
                        </li>
                        <li>
                            <strong>Essay:</strong> <a href="https://briantomasik.com/personal-thoughts-on-romance/" target="_blank" class="text-blue-600 underline">Personal thoughts on romance by Brian Tomasik</a>
                        </li>
                        <li>
                            <strong>Blog Post:</strong> <a href="https://www.betonit.ai/p/shes-the-one" target="_blank" class="text-blue-600 underline">She's the One by Bryan Caplan</a>
                        </li>
                        <li>
                            <strong>Blog Post:</strong> <a href="https://waitbutwhy.com/2014/02/pick-life-partner.html" target="_blank" class="text-blue-600 underline">How to Pick Your Life Partner by Tim Urban</a>
                        </li>
                        <li>
                            <strong>Blog Post:</strong> <a href="https://colah.github.io/personal/micromarriages/" target="_blank" class="text-blue-600 underline">Micromarriages by Chris Olah</a>
                        </li>
                    </ul>
                </div>
                <!-- End of New Section -->

            </div>

            <!-- Instructions Screen -->
            <div id="instructions-screen" class="hidden">
                <h2 class="text-2xl font-semibold mb-4 text-center">Before You Begin</h2>
                <p class="text-gray-700 mb-6 text-center">
                    Some of the questions in this quiz are intentionally a bit vague. Feel free to interpret them in a way that makes sense to you. Take as much time or as little time as you'd like to think about each question.
                </p>
                <button onclick="startQuiz()" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600">
                    Start Quiz
                </button>
            </div>

            <!-- Question Screen -->
            <div id="question-screen" class="hidden">
                <h2 id="section-name" class="text-2xl font-semibold mb-4"></h2>
                <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                    <div id="progress-bar" class="bg-blue-500 rounded-full h-2 transition-all duration-300" style="width: 0%"></div>
                </div>

                <h2 id="question-text" class="text-xl font-semibold mb-6"></h2>

                <!-- Multiple Choice Container -->
                <div id="multiple-choice" class="space-y-3"></div>

                <!-- Slider Container -->
                <div id="slider-container" class="hidden">
                    <input type="range" id="slider" class="slider" min="0" max="100" value="50">
                    <div class="flex justify-between text-sm text-gray-600">
                        <span id="slider-left-label">Strongly Disagree</span>
                        <span id="slider-value">50%</span>
                        <span id="slider-right-label">Strongly Agree</span>
                    </div>
                    <button onclick="submitSlider()" class="mt-4 w-full bg-blue-500 text-white py-2 px-6 rounded-lg hover:bg-blue-600">
                        Next
                    </button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="hidden"></div>
        </div>
    </div>

    <script>
    const sections = [
        // [Your existing sections and questions remain unchanged]
        // ... [Sections and questions code] ...
    ];

    let currentSectionIndex = 0;
    let currentQuestionIndex = 0;
    let sectionScores = [];
    let sectionMaxScores = [];
    let dealbreakerFailed = false; // Flag to check if a dealbreaker question was answered "incorrectly"

    function showInstructions() {
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('instructions-screen').classList.remove('hidden');
    }

    function startQuiz() {
        document.getElementById('instructions-screen').classList.add('hidden');
        document.getElementById('question-screen').classList.remove('hidden');

        // Properly initialize the arrays
        sectionScores = sections.map(() => 0);
        sectionMaxScores = sections.map((section) => {
            const maxScore = section.questions
                .filter(q => !q.isDealbreaker)
                .reduce((sum, q) => {
                    const questionWeight = q.weight || 1;
                    const questionMaxScore = 10 * section.weight * questionWeight;
                    return sum + questionMaxScore;
                }, 0);
            return maxScore;
        });

        currentSectionIndex = 0;
        currentQuestionIndex = 0;
        dealbreakerFailed = false;
        showQuestion();
    }

    function showQuestion() {
        const section = sections[currentSectionIndex];
        const question = section.questions[currentQuestionIndex];
        document.getElementById('section-name').textContent = section.name;
        document.getElementById('question-text').textContent = question.text;

        // Update progress bar
        const totalQuestions = section.questions.length;
        const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;

        const multipleChoice = document.getElementById('multiple-choice');
        const sliderContainer = document.getElementById('slider-container');

        if (question.type === 'choice') {
            multipleChoice.classList.remove('hidden');
            sliderContainer.classList.add('hidden');
            multipleChoice.innerHTML = question.options.map((option, index) => `
                <button 
                    onclick="selectOption(${index})" 
                    class="option-button w-full text-left p-4 rounded-lg border border-gray-200 hover:border-blue-500 hover:bg-blue-50"
                >
                    ${option.text}
                </button>
            `).join('');
        } else if (question.type === 'slider') {
            multipleChoice.classList.add('hidden');
            sliderContainer.classList.remove('hidden');
            const slider = document.getElementById('slider');
            slider.min = question.min || 0;
            slider.max = question.max || 100;
            slider.value = (slider.min + slider.max) / 2;
            document.getElementById('slider-value').textContent = `${slider.value}%`;
            document.getElementById('slider-left-label').textContent = question.sliderLeftLabel || "Strongly Disagree";
            document.getElementById('slider-right-label').textContent = question.sliderRightLabel || "Strongly Agree";
    
            slider.oninput = function() {
                document.getElementById('slider-value').textContent = `${this.value}%`;
            };
        }
    }

    function selectOption(index) {
        const section = sections[currentSectionIndex];
        const question = section.questions[currentQuestionIndex];
        const selectedOption = question.options[index];

        if (question.isDealbreaker && !selectedOption.isAcceptable) {
            dealbreakerFailed = true;
        }

        if (!question.isDealbreaker) {
            const questionWeight = question.weight || 1; // Default weight is 1
            const optionScore = (selectedOption.score || 0) * section.weight * questionWeight;
            sectionScores[currentSectionIndex] += optionScore;
        }
        nextQuestion();
    }

    function submitSlider() {
        const value = parseInt(document.getElementById('slider').value) || 0;
        const section = sections[currentSectionIndex];
        const question = section.questions[currentQuestionIndex];

        if (question.isDealbreaker) {
            // Handle dealbreaker logic for slider if needed
        } else {
            const questionWeight = question.weight || 1; // Default weight is 1
            const sliderScore = ((value / 100) * 10) * section.weight * questionWeight;
            sectionScores[currentSectionIndex] += sliderScore;
        }
        nextQuestion();
    }

    function nextQuestion() {
        const section = sections[currentSectionIndex];
        if (currentQuestionIndex < section.questions.length - 1) {
            currentQuestionIndex++;
        } else {
            // Check if we need to end the quiz early due to dealbreaker in the first section
            if (currentSectionIndex === 0 && dealbreakerFailed) {
                showResults();
                return;
            }

            if (currentSectionIndex < sections.length - 1) {
                currentSectionIndex++;
                currentQuestionIndex = 0;
            } else {
                showResults();
                return;
            }
        }
        showQuestion();
    }

    function showResults() {
        // Filter out any undefined or NaN values
        const validSectionScores = sectionScores.filter(score => typeof score === 'number' && !isNaN(score));
        const validSectionMaxScores = sectionMaxScores.filter(score => typeof score === 'number' && !isNaN(score));

        let totalScore = validSectionScores.reduce((a, b) => a + b, 0);
        const maxPossibleScore = validSectionMaxScores.reduce((a, b) => a + b, 0);

        // Prevent totalScore from being less than zero
        totalScore = Math.max(0, totalScore);

        let percentage = (totalScore / maxPossibleScore) * 100;

        if (dealbreakerFailed) {
            totalScore = 0;
            percentage = 0;
        }

        // Cap percentage at 100%
        percentage = Math.min(percentage, 100);

        let message;
        if (dealbreakerFailed) {
            message = "Unfortunately, we have some fundamental differences that are important to me.";
        } else if (percentage >= 70) {
            message = "High compatibility detected! We should talk to each other!";
        } else if (percentage >= 50) {
            message = "We have quite a bit of alignment. There's definitely potential!";
        } else if (percentage >= 35) {
            message = "We may not be compatible, but should get to know each other more to be sure!";
        } else {
            message = "We don't seem very compatible :(";
        }

        const resultsScreen = document.getElementById('results-screen');
        document.getElementById('question-screen').classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        // Conditionally include additional sections
        let additionalContent = '';
        if (percentage >= 35) {
            additionalContent = `
                <!-- New Section: Let's Get in Touch -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">Let's get in touch!</h3>
                    <p class="text-gray-700 mb-2"><strong>Phone:</strong> <a href="tel:+447305204222" class="text-blue-600 underline">+44 7305 204222</a></p>
                    <p class="text-gray-700"><strong>Email:</strong> <a href="mailto:ben_dnorman@icloud.com" class="text-blue-600 underline">ben_dnorman@icloud.com</a></p>
                </div>

                <!-- New Section: More About Me -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">More About Me</h3>
                    <p class="text-gray-700">
                        <!-- Add more information about yourself here -->
                        I'm passionate about technology, philosophy, and making a positive impact on the world. In my free time, I enjoy reading, hiking, and exploring new ideas.
                    </p>
                </div>

                <!-- New Section: What My Friends Say About Me -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">What My Friends Say About Me</h3>
                    <blockquote class="italic text-gray-600">
                        <!-- Add testimonials or quotes from friends here -->
                        "Ben is one of the most thoughtful and driven people I know. His commitment to his goals is inspiring." - Friend A
                    </blockquote>
                    <blockquote class="italic text-gray-600 mt-4">
                        "Always up for a deep conversation or a new adventure, Ben brings energy and insight to everything he does." - Friend B
                    </blockquote>
                </div>
            `;
        }

        resultsScreen.innerHTML = `
            <div class="text-center">
                <h2 class="text-2xl font-bold mb-6">Overall Compatibility Score</h2>
                <div class="text-5xl font-bold text-blue-500 mb-6">${percentage.toFixed(1)}%</div>
                <div class="w-full bg-gray-200 rounded-full h-4 mb-6">
                    <div class="bg-blue-500 rounded-full h-4 transition-all duration-1000" style="width: ${percentage}%"></div>
                </div>
                <p class="text-lg mb-8">${message}</p>
                ${additionalContent}
                <button onclick="location.reload()" class="mt-8 bg-gray-500 text-white py-2 px-6 rounded-lg hover:bg-gray-600">
                    Retake Quiz
                </button>
            </div>
        `;
    }

    // Initialize slider value display
    document.getElementById('slider')?.addEventListener('input', function() {
        document.getElementById('slider-value').textContent = `${this.value}%`;
    });
    </script>

</body>
</html>


